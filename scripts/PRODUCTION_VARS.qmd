---
title: "Production indicators"
format: html
editor: visual
---

```{r grappe}

load(here('data', 'grappes.RData'))
```

# Potential

```{r potential}
# Load data
load(here('data', 'total_precipitation.RData'))
load(here('data', 'built_up_change.RData'))
load(here('data', 'water_depletion.RData'))
load(here('data', 'biodiversity_intactness.RData'))

# merge
potential <- total_precipitation %>% 
  select(grappe, sh_total_precipitation) %>% 
  left_join(built_up_change %>% st_drop_geometry() %>% 
            select(grappe, sh_built_up_change),
            by = 'grappe') %>% 
  left_join(water_depletion %>% st_drop_geometry() %>% 
            select(grappe, water_depletion_ratio),
            by = 'grappe') %>% 
  left_join(biodiversity_intactness %>% st_drop_geometry() %>% 
            select(grappe, biodiversity_intactness_index),
            by = 'grappe')

vis_miss(potential)

```

# Availability

```{r availability}

load(here('data', 'landless.RData'))
load(here('data', 'input_market.RData'))
load(here('data', 'food_supply_chain.RData'))
load(here('data', 'credit.RData'))

# Merge with EAs/grappes
availability <- landless %>% 
  select(grappe, sh_landless) %>% 
  left_join(input_market %>% st_drop_geometry() %>% 
            select(grappe, sh_input_from_market), 
            by = "grappe") %>% 
  left_join(food_supply_chain  %>% st_drop_geometry() %>% 
            select(grappe, empl_food_processing),
            by = "grappe") %>% 
  left_join(credit %>% st_drop_geometry() %>% 
            select(grappe, sh_credit_access),
            by = "grappe")

vis_miss(availability)
  
```

```{r production}

production <- merge(potential, availability %>% st_drop_geometry(), by = 'grappe')

save(production, file = here('data', 'production.RData'))
```
